\section{Simulation Analysis}
\label{sec:simulation}

In addition to theoretical analysis, we computed a simulation of the audio amplifier using Ngspice, in which we employed the transistor models provided by the professor. Thus, we started by performing an operating point simulation to verify that the transistors were operating in the forward active region (F.A.R.). The results are shown in Table~\ref{tab:opngspice}, side by side with the ones obtained theoretically.

\noindent
\begin{minipage}[c]{0.5\linewidth}

\begin{table}[H]
 \centering
 \begin{tabular}{|l|r|}
 \hline
 {\bf Name} & {\bf Value [V]} \\ \hline
\input{../sim/op_tab}
 \end{tabular}
 \caption{Verification of the F.A.R. using Ngspice}
 \label{tab:opngspice}
 \end{table}
 
\end{minipage}
\begin{minipage}[c]{0.5\linewidth}

\vspace{-0.5mm}
 
 \begin{table}[H]
 \centering
 \begin{tabular}{|l|r|}
 \hline
 {\bf Name} & {\bf Value [V]} \\ \hline
\input{../mat/opteor}
 \end{tabular}
 \caption{Theoretical verification of the F.A.R.}
 \label{tab:opngspice}
 \end{table}
 
\end{minipage}

\vspace{3mm}

Analysing the obtained values, one notices that $V_{CE1}>V_{BE1}$ and $V_{EC2}>V_{EB2}$, which allows us to conclude that the transistors are operating in the F.A.R.. \\

Furthermore, the gain for the total circuit as a function of the frequency in logarithmic scale is illustrated in Figure~\ref{fig:sim}. Next to it, is the same graph, obtained previously by theoretical analysis.

\vspace{-25mm}

\noindent
\begin{minipage}[c]{0.5\linewidth}

\begin{figure}[H] \centering
\includegraphics[width=1\linewidth]{../sim/vo2f.pdf}
\caption{Gain in function of frequency response (Ngspice).}
\label{fig:sim}
\end{figure}

\end{minipage}
\begin{minipage}[c]{0.5\linewidth}

\vspace{16mm}

\begin{figure}[H] \centering
\includegraphics[width=1\linewidth]{gainfreq.eps}
\caption{Gain in function of frequency response (Octave).}
\label{fig:octave}
\end{figure}

\end{minipage}

\vspace{10mm}

In an attempt to get a lower cutoff frequency, we ran several simulations, changing the capacity of the input coupling capacitor, $C_{in}$. With these simulations, we were able to reach a balance between the cost and a frequency that wouldn't be much high.\\

Regarding the bypass capacitor, we can consider that the purpose of $C_b$ is to bypass the resistor $R_e$, which reduces the gain, although it stabilises the temperature effect. Hence, the bypass capacitor produces the gain stabilisation in the desired passband, as it works both as an open circuit for low frequencies (DC) and as a short circuit for higher frequencies (AC).\\

In what concerns $R_C$, the higher its resistance value, the higher the gain obtained in the gain stage. Similarly to what we did with $C_{in}$, it was also necessary to run simulations with different values for $R_C$, in order to find an efficient balance between its cost and the gain. \\

The values obtained for the output voltage gain in the passband, the lower and upper 3dB cut off frequencies, the bandwidth and the input and output impedances are listed in Table~\ref{tab:spice}, once again, side by side to the ones obtained theoretically.

\noindent
\begin{minipage}[c]{0.5\linewidth}

\begin{table}[H]
 \centering
 \begin{tabular}{|l|r|}
 \hline
 {\bf Name} & {\bf Value} \\ \hline
\input{../sim/data_tab}
\input{../sim/Zout_tab}
 \end{tabular}
 \caption{Voltage gain, lower and upper cut off frequencies, bandwidth and impedances (Ngspice).}
 \label{tab:spice}
 \end{table}
 
\end{minipage}
\begin{minipage}[c]{0.5\linewidth}
 
 \begin{table}[H]
 \centering
 \begin{tabular}{|l|r|}
 \hline
 {\bf Name} & {\bf Value} \\ \hline
\input{../sim/data_tab}
\input{../sim/Zout_tab}
 \end{tabular}
 \caption{Voltage gain and impedances (Octave).}
 \label{tab:spice}
 \end{table}
 
\end{minipage}


