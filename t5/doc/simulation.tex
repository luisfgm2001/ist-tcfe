\section{Simulation Analysis}
\label{sec:simulation}

In this part of the assignment, we computed a simulation of the BandPass Filter in Ngspice, so as to achieve a central frequency of 1000 Hz and a gain of 40 dB at this frequency.\\

As we proceeded previously, we started by determining the frequency response of the circuit. The gain plots for both analysis are presented in Figures~\ref{fig:gainngspice} and ~\ref{fig:gainoctave}, side by side.

\vspace{-25mm}

\noindent
\begin{minipage}[c]{0.5\linewidth}

\begin{figure}[H] \centering
\includegraphics[width=0.86\linewidth]{../sim/vdbf.pdf}
\caption{Frequency Response - Gain (Ngspice).}
\label{fig:gainngspice}
\end{figure}

\end{minipage}
\begin{minipage}[c]{0.5\linewidth}

\vspace{9mm}

\begin{figure}[H] \centering
\includegraphics[width=0.86\linewidth]{gainoctave.eps}
\caption{Frequency Response - Gain (Octave).}
\label{fig:gainoctave}
\end{figure}

\end{minipage}

\vspace{10mm}

Furthermore, we plotted the phase of the frequency response for both methods in Figures~\ref{fig:phasengspice} and ~\ref{fig:phaseoctave}.

\vspace{-15mm}

\noindent
\begin{minipage}[c]{0.5\linewidth}

\begin{figure}[H] \centering
\includegraphics[width=0.86\linewidth]{../sim/phasef.pdf}
\caption{Frequency Response - Phase (Ngspice).}
\label{fig:phasengspice}
\end{figure}

\end{minipage}
\begin{minipage}[c]{0.5\linewidth}

\vspace{15mm}

\begin{figure}[H] \centering
\includegraphics[width=0.86\linewidth]{phaseoctave.eps}
\caption{Frequency Response - Phase (Octave).}
\label{fig:phaseoctave}
\end{figure}

\end{minipage}

\vspace{10mm}

By analysing the plots, it becomes evident that the theoretical and the simulated gain graphs match precisely. Nevertheless, it is pretty straightforward that the phase plots have major discrepancies: on the one hand, in the theoretical one, the phase starts at $90\degree$ and decreases until it stabilises at $-90\degree$, owing to the existence of two poles due to the two capacitors $C_1$ and $C_2$; on the other, acknowledging the fact that Ngspice only considers the range $[-180\degree , 180\degree ]$, one observes that, although the phase also starts at $90\degree$ in the simulation, it decreases until $-270\degree$. In its turn, this can be explained by the existence of two additional poles in the real model of the OP-AMP, which werenâ€™t considered in the theoretical analysis.\\

Moreover, we obtained the low and high cutoff frequencies, in order to calculate the central frequency. We then calculated the output voltage gain, the input and output impedances at the central frequency and the deviations of the gain and central frequency. The results of both theoretical and simulation analysis are shown in Tables~\ref{tab:resultsngspice} and ~\ref{tab:resultsoctave}.

\vspace{5mm}

\noindent
\begin{minipage}[c]{0.5\linewidth}

\begin{table}[H]
 \centering
 \begin{tabular}{|l|r|}
 \hline
 \input{../sim/results_tab}
 \input{../sim/zout_tab}
 \end{tabular}
 \caption{Results of the simulation (Ngspice). The impedances are presented in $\Omega$.}
 \label{tab:resultsngspice}
 \end{table}
 
\end{minipage}
\begin{minipage}[c]{0.5\linewidth}
 
 \begin{table}[H]
 \centering
 \begin{tabular}{|l|r|}
 \hline
 \input{../mat/octavetab}
 \end{tabular}
 \caption{Results of the theoretical analysis (Octave).}
 \label{tab:resultsoctave}
 \end{table}
 
\end{minipage}

\vspace{10mm}

By observation of the obtained results, one notices that there isn't much difference between the theoretical ones and those obtained by simulation. Indeed, the slight difference verified in some of them might be explained by the fact that, in the theoretical analysis, we used an approximated model of the OP-AMP, where we considered the input and output impedances to be infinite and zero, respectively, whereas the methods used by Ngspice are far more complex, due to the existence of non-linear components (diodes and transistors) in the internal circuit of the OP-AMP.\\

Finally, to calculate the merit $M$ of the BandPass Filter, we used the values obtained by simulation. They should be more reliable, since in the theoretical analysis we considered several approximations that may have affected the results. The merit $M$, as well as the cost of the circuit, are illustrated in Table~\ref{tab:merit}. In what concerns the cost, we took into account the cost of the components of the OP-AMP.

\vspace{2mm}

\begin{center}
\begin{tabular}{ | c | c | }\hline
\input{../sim/merito_tab} 
\end{tabular}
\captionof{table}[]{Cost and merit of the BandPass Filter.}
\label{tab:merit}
\end{center}

\vspace{3mm}
